## Mutant Detector — Copilot instructions

This file helps AI coding agents become productive quickly in this repository. Keep suggestions small, deterministic, and test-driven.

- Project root: `pom.xml` controls Java version (property `java.version`) and build. Prefer the included Maven wrapper: `./mvnw` / `mvnw.cmd`.
- Run/build: `./mvnw -DskipTests=true clean package` (Windows: `.\mvnw.cmd ...`). Run full tests with `./mvnw test`.

Quick pointers
- Code layout (N-layer):
  - `src/main/java/com/mercadolibre/mutant/domain/detector` — core algorithm (`MutantDetector.java`, `MutantDetectorConfig.java`).
  - `.../application/service` — business logic and caching (`MutantService.java`, `StatsService.java`).
  - `.../application/validation` — custom annotation/validator (`ValidDna.java`, `DnaValidator.java`) used on controller DTOs.
  - `.../infrastructure/controller` — REST layer (`MutantController.java`, `ErrorResponse.java`).
  - `.../domain/entity/DnaRecord.java` and `.../repository/DnaRepository.java` — persistence model (H2 DB).

What matters most (patterns & examples)
- Algorithm: uses `char[][]` and directional checks with early termination for performance. See `MutantDetector.checkSequence(...)` for the loop-unrolled pattern.
- Idempotency: DNA requests are deduplicated with SHA-256 hash stored in `DnaRecord.dnaHash` — avoid re-analyzing the same DNA.
- Validation: controllers accept `DnaRequest` annotated `@Valid` and `@ValidDna` — run `DnaValidatorTest` as example of inputs to accept/reject.
- Lombok is used for entities/DTOs — IDEs should enable Lombok annotation processing.

Build, test and debug flows
- Use the Maven wrapper in CI and locally: `.\mvnw.cmd clean test` (Windows) or `./mvnw clean test`.
- Quick dev run: `.\mvnw.cmd spring-boot:run` then
  - Swagger UI: `http://localhost:8080/swagger-ui.html`
  - H2 console: `http://localhost:8080/h2-console` (JDBC URL: `jdbc:h2:file:~/test`, user `sa`, empty password)
- Coverage: `.\mvnw.cmd jacoco:report` -> `target/site/jacoco/index.html`.

Testing & PR guidance
- Every change that touches logic must include or update unit tests under `src/test/java/...` (follow existing tests as templates).
- Run full test+coverage locally before asking for review: `.\mvnw.cmd clean test jacoco:report`.

Files to inspect for context when modifying behavior
- `MutantDetector.java` — algorithm entrypoints and performance assumptions.
- `MutantService.java` — where persistence and duplicate detection happen.
- `DnaValidator.java` / `ValidDna.java` — input constraints (NxN, allowed letters A/T/C/G).
- `MutantController.java` — HTTP status codes mapping (200, 403, 400) and error handling via `GlobalExceptionHandler`.

Integration & infra notes
- Embedded H2 is persistent on disk (`jdbc:h2:file:~/test`) — tests rely on an in-memory-like state; CI may expect a clean DB.
- API docs are generated by Springdoc/OpenAPI; avoid breaking endpoint signatures without updating tests and Swagger annotations.

Tips for the AI
- Prefer minimal, well-tested changes. Use existing tests as the contract. Example: to change detection logic, add targeted unit tests in `domain/detector/MutantDetectorTest.java` first.
- When adding new dependencies, update `pom.xml` and ensure the project still builds with the Maven wrapper.
- Respect the SHA-256 deduplication: modifications that change DNA normalization must migrate existing records or preserve compatibility.

If anything in these instructions is unclear or you want more detail on a specific area (build, algorithm, tests, or Java upgrade), ask and I'll expand the file.
